<!DOCTYPE html>
<html lang="de" class="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Culinary Archive - Taste the Next Level</title>
  <link rel="stylesheet" href="css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
  <!-- Gamification Effects -->
  <canvas id="confetti-canvas"></canvas>

  <nav class="nav-wrapper" id="navbar">
    <div class="container navbar">
      <div class="nav-brand text-gradient" style="cursor: pointer;" onclick="app.showFeed()">üî• Culinary Archive</div>
      <div class="nav-links">
        <div id="authLinks" style="display: flex; gap: 1rem; align-items: center;">
          <button class="nav-link" style="background:none;" onclick="app.showFeed()">Entdecken</button>
          <button class="btn-glass" onclick="openModal('authModal')">Login</button>
        </div>
        <div id="userMenu" style="display: none; align-items: center; gap: 1rem;">
          <div class="level-badge" id="navLevelBadge" title="Dein aktuelles Level!"
            style="width: 40px; height: 40px; font-size: 1.2rem;">1</div>
          <button class="nav-link" style="background:none;" onclick="app.showFeed()">Entdecken</button>
          <button class="nav-link" style="background:none;" onclick="app.showProfile()">Profil & Rezepte</button>
          <button class="nav-link" style="background:none; color: var(--text-muted);"
            onclick="app.logout()">Logout</button>
        </div>
        <button id="themeToggle" class="theme-toggle" style="margin-left: 1rem;">üåô</button>
      </div>
    </div>
  </nav>

  <!-- USER GAMIFICATION DASHBOARD (Hidden unless logged in) -->
  <section class="container reveal" id="gamificationDashboard" style="display: none; padding-top: 150px;">
    <h2>Willkommen zur√ºck, <span id="dashUsername" class="text-gradient">Chef</span>!</h2>
    <div class="gamification-widget">
      <div class="level-badge" id="dashLevelBadge">1</div>
      <div class="xp-info">
        <h4>Rank: <span class="text-gradient" id="dashRankTitle">Novice Cook</span></h4>
        <div style="font-size: 0.9rem; color: var(--text-muted);">
          <span id="dashXpLabel">0 / 100 XP</span> bis zum n√§chsten Level
        </div>
        <div class="xp-bar-bg">
          <div class="xp-bar-fill" id="dashXpBar" style="width: 0%;"></div>
        </div>
      </div>
      <div style="margin-left:auto; display: flex; flex-direction: column; align-items: center; gap:0.5rem;">
        <div
          style="width: 60px; height: 60px; border-radius: 50%; border: 3px solid var(--primary); overflow:hidden; background: var(--surface-border); display: flex; justify-content: center; align-items:center;">
          <img id="dashProfileImage" src="" alt="Profile"
            style="width:100%; height:100%; object-fit:cover; display:none;">
          <span id="dashProfileInitials" style="font-weight:bold; font-size:1.5rem; color:var(--text-muted);">?</span>
        </div>
        <label for="profileUpload"
          style="font-size: 0.75rem; color:var(--primary); cursor:pointer; font-weight:bold;">√ÑNDERN</label>
        <input type="file" id="profileUpload" style="display:none;" accept="image/*"
          onchange="app.uploadProfileImage(event)">
      </div>
    </div>
  </section>

  <!-- HERO SECTION -->
  <header class="hero container" id="heroSection">
    <div class="hero-content reveal">
      <h1>Koche. Teile.<br><span class="text-gradient">Level Up!</span></h1>
      <p>Entdecke die besten Rezepte der Community. Teile deine eigenen Meisterwerke, sammle XP und steige im Level auf.
        Verwandle deine K√ºche in ein Spiel.</p>
      <div class="hero-buttons">
        <button class="btn-primary"
          onclick="document.getElementById('feed').scrollIntoView({behavior: 'smooth'})">Entdecken</button>
        <button class="btn-glass" id="heroAuthBtn" onclick="openModal('authModal')">Login</button>
      </div>
    </div>
    <div class="hero-visuals">
      <div class="floating-circle c1"></div>
      <div class="floating-circle c2"></div>
      <!-- Decorative 3D-ish image floating -->
      <img
        src="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"
        alt="Food"
        style="position: absolute; width: 350px; height: 350px; border-radius: 50%; object-fit: cover; top: 15%; right: 5%; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); border: 20px solid var(--surface); animation: floatCircle 8s infinite ease-in-out;">
    </div>
  </header>

  <!-- FEED SECTION -->
  <main class="container" id="feed" style="padding-top: 5rem;">
    <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 2rem;">
      <h2 class="section-title reveal" style="margin-bottom: 1.5rem;">Trendige <span
          class="text-gradient">Rezepte</span></h2>

      <div class="search-bar-container"
        style="display: flex; gap: 1rem; width: 100%; max-width: 600px; position: relative;">
        <div style="position: relative; flex: 1;">
          <!-- Typahead placeholder for VSCode effect -->
          <input type="text" id="searchInputGhost" class="form-control"
            style="position: absolute; top:0; left:0; width: 100%; height: 100%; color: var(--text-muted); opacity: 0.5; pointer-events: none; z-index: 1;"
            readonly disabled>
          <!-- Actual interactive input -->
          <input type="text" id="searchInput" class="form-control"
            placeholder="Suche in Titeln, Tags, Zutaten oder nach User..."
            style="position: relative; width: 100%; background: transparent; z-index: 2;"
            oninput="app.handleSearchInput(event)" onkeydown="app.handleSearchKeyDown(event)">
        </div>

        <select id="searchCategory" class="form-control" style="width: 150px; cursor: pointer;"
          onchange="app.triggerSearch()">
          <option value="">Alle Kategorien</option>
          <option value="Fr√ºhst√ºck">Fr√ºhst√ºck</option>
          <option value="Hauptgericht">Hauptgericht</option>
          <option value="Dessert">Dessert</option>
          <option value="Snack">Snack</option>
          <option value="Getr√§nk">Getr√§nk</option>
          <option value="Sonstiges">Sonstiges</option>
        </select>

        <button class="btn-primary" style="padding: 0.5rem 1rem;" onclick="app.triggerSearch()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8" />
            <line x1="21" y1="21" x2="16.65" y2="16.65" />
          </svg>
        </button>
      </div>
    </div>

    <div class="recipe-grid" id="recipesContainer">
      <!-- Injected by JS -->
    </div>
  </main>

  <!-- PROFILE SECTION -->
  <main class="container" id="profileMain" style="display: none; padding-top: 5rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <h2 class="section-title reveal" style="margin-bottom: 0;">Dein <span class="text-gradient">Bereich</span></h2>
        <button class="btn-glass" style="font-size: 0.8rem; padding: 0.5rem 1rem;"
          onclick="app.openEditProfileModal()">‚úèÔ∏è Profil bearbeiten</button>
      </div>
      <div style="display: flex; gap: 1rem;">
        <button class="btn-primary" id="tabMyRecipes" onclick="app.switchProfileTab('my')">Meine Rezepte</button>
        <button class="btn-glass" id="tabFavorites" onclick="app.switchProfileTab('fav')">Favoriten</button>
      </div>
    </div>

    <div class="recipe-grid" id="profileRecipesContainer">
      <!-- Injected by JS (My Recipes) -->
    </div>
    <div class="recipe-grid" id="favoritesContainer" style="display: none;">
      <!-- Injected by JS (Favorites) -->
    </div>
  </main>

  <!-- AUTH MODAL -->
  <div class="modal-overlay" id="authModal" onclick="if(event.target === this) closeModal('authModal')">
    <div class="modal">
      <h2 style="margin-bottom: 2rem; font-size: 2rem;">Willkommen.</h2>
      <div class="form-group">
        <button id="toggleAuthBtn" class="btn-glass" style="width: 100%; border-radius:12px; margin-bottom: 1.5rem;"
          onclick="app.toggleAuthMode()">Noch keinen Account? Registrieren &rarr;</button>
      </div>
      <form id="authForm" onsubmit="app.handleAuth(event)">
        <div class="form-group">
          <label>Benutzername</label>
          <input type="text" id="authUsername" class="form-control" required>
        </div>
        <div class="form-group" id="registerGroup1" style="display: none;">
          <label>Email</label>
          <input type="email" id="authEmail" class="form-control">
        </div>
        <div class="form-group" id="registerGroup2" style="display: none;">
          <label>Geburtsdatum</label>
          <input type="date" id="authDate" class="form-control">
        </div>
        <div class="form-group">
          <label>Passwort</label>
          <input type="password" id="authPassword" class="form-control" required>
        </div>
        <button type="submit" class="btn-primary" style="width: 100%; justify-content: center; margin-top: 1rem;"><span
            id="authSubmitText">Einloggen</span></button>
      </form>
      <button class="modal-close-bottom" type="button" onclick="closeModal('authModal')">Schlie√üen</button>
    </div>
  </div>

  <!-- ADD RECIPE MODAL -->
  <div class="modal-overlay" id="recipeModal" onclick="if(event.target === this) closeModal('recipeModal')">
    <div class="modal" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
      <h2 style="margin-bottom: 2rem;">Neues <span class="text-gradient">Meisterwerk</span></h2>
      <form id="recipeForm" onsubmit="app.submitRecipe(event)">
        <!-- Image Drag & Drop Area -->
        <div class="form-group"
          style="position:relative; width:100%; height:200px; border:2px dashed var(--primary); border-radius: 12px; display:flex; justify-content:center; align-items:center; overflow:hidden; cursor:pointer;"
          onclick="document.getElementById('recipeImageInput').click()" id="imageDropZone">
          <span
            style="color:var(--text-muted); pointer-events:none; z-index:2; padding:1rem; text-align:center; background:var(--surface); border-radius:12px; backdrop-filter:var(--glass-fx);">Bild
            hochladen<br><small>(Klick oder Drag&Drop, max 5MB)</small></span>
          <img id="imagePreview"
            style="position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; display:none; z-index:1;">
        </div>
        <input type="file" id="recipeImageInput" accept="image/*" style="display:none;"
          onchange="app.previewImage(event)">

        <div class="form-group"><label>Titel</label><input type="text" id="rTitle" class="form-control" required></div>
        <div style="display: flex; gap: 1rem;">
          <div class="form-group" style="flex:1"><label>Zubereitungszeit (Min)</label><input type="number" id="rPrep"
              class="form-control" required></div>
          <div class="form-group" style="flex:1"><label>Kochzeit (Min)</label><input type="number" id="rCook"
              class="form-control" required></div>
        </div>
        <div class="form-group">
          <label>Schwierigkeit</label>
          <select id="rDiff" class="form-control">
            <option value="leicht">Leicht</option>
            <option value="mittel">Mittel</option>
            <option value="schwer">Schwer</option>
          </select>
        </div>
        <div class="form-group">
          <label>Kategorie</label>
          <select id="rCat" class="form-control">
            <option value="Fr√ºhst√ºck">Fr√ºhst√ºck</option>
            <option value="Hauptgericht" selected>Hauptgericht</option>
            <option value="Dessert">Dessert</option>
            <option value="Vegetarisch">Vegetarisch</option>
            <option value="Sonstiges">Sonstiges</option>
          </select>
        </div>
        <div class="form-group">
          <label>Tags</label>
          <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; flex-wrap: wrap;" id="rTagsContainer"></div>
          <div style="display: flex; gap: 0.5rem;">
            <input type="text" id="rTagInput" class="form-control"
              placeholder="Tag eingeben (z.B. vegan) und Enter dr√ºcken"
              onkeypress="if(event.key === 'Enter') { event.preventDefault(); app.addTag('rTagInput', 'rTagsContainer', 'rTagsArray'); }">
            <button type="button" class="btn-glass"
              onclick="app.addTag('rTagInput', 'rTagsContainer', 'rTagsArray')">Hinzuf√ºgen</button>
          </div>
          <input type="hidden" id="rTagsArray" name="tags" value="">
        </div>
        <div class="form-group markdown-editor-group">
          <label style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 0.5rem;">
            <span>Zutaten <svg title="Markdown Supported" width="30" height="18" viewBox="0 0 208 128"
                fill="var(--text-muted)" style="vertical-align: middle; margin-left: 5px;">
                <path d="M30 98V30h20l20 25 20-25h20v68H90V59L70 84 50 59v39zm125 0l-30-33h20V30h20v35h20z" />
              </svg></span>
            <span style="font-size: 0.8rem; color: var(--text-muted);">Editor | Live Preview</span>
          </label>
          <div style="display: flex; gap: 1rem; height: 150px;">
            <textarea id="rIng" class="form-control"
              style="flex: 1; resize: none; overflow-y: auto; font-family: monospace;"
              placeholder="- 500g Mehl&#10;- 2 Eier" oninput="app.updateLivePreview('rIng', 'rIngPreview')"
              required></textarea>
            <div id="rIngPreview" class="markdown-body form-control"
              style="flex: 1; background: var(--surface); overflow-y: auto;">*Live Preview...*</div>
          </div>
        </div>
        <div class="form-group markdown-editor-group">
          <label style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 0.5rem;">
            <span>Zubereitungsschritte <svg title="Markdown Supported" width="30" height="18" viewBox="0 0 208 128"
                fill="var(--text-muted)" style="vertical-align: middle; margin-left: 5px;">
                <path d="M30 98V30h20l20 25 20-25h20v68H90V59L70 84 50 59v39zm125 0l-30-33h20V30h20v35h20z" />
              </svg></span>
            <span style="font-size: 0.8rem; color: var(--text-muted);">Editor | Live Preview</span>
          </label>
          <div style="display: flex; gap: 1rem; height: 250px;">
            <textarea id="rSteps" class="form-control"
              style="flex: 1; resize: none; overflow-y: auto; font-family: monospace;"
              placeholder="1. **Schritt 1:** Ofen vorheizen..."
              oninput="app.updateLivePreview('rSteps', 'rStepsPreview')" required></textarea>
            <div id="rStepsPreview" class="markdown-body form-control"
              style="flex: 1; background: var(--surface); overflow-y: auto;">*Live Preview...*</div>
          </div>
        </div>

        <button type="submit" class="btn-primary" style="width: 100%; justify-content: center;"><span
            style="font-size:1.2rem; margin-right:5px;">+50 XP</span> Rezept ver√∂ffentlichen</button>
      </form>
      <button class="modal-close-bottom" type="button" onclick="closeModal('recipeModal')">Abbrechen</button>
    </div>
  </div>

  <!-- VIEW RECIPE MODAL (For Markdown display) -->
  <div class="modal-overlay" id="viewRecipeModal" onclick="if(event.target === this) closeModal('viewRecipeModal')">
    <div class="modal" style="max-width: 800px; max-height: 90vh; overflow-y: auto; padding: 0;">
      <img id="viewImg" src=""
        style="width: 100%; height: 300px; object-fit: cover; border-top-left-radius: 20px; border-top-right-radius: 20px;">
      <div style="padding: 2rem;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
          <div>
            <span id="viewCat"
              style="color: var(--primary); font-weight: bold; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px;">Kategorie</span>
            <h2 id="viewTitle" style="margin-top: 0.5rem; font-size: 2.5rem; line-height: 1.1;">Titel</h2>
            <div id="viewTags" style="display: flex; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap;"></div>
            <div style="color: var(--text-muted); margin-top: 0.5rem;">von <span id="viewAuthor" class="text-gradient"
                style="font-weight: bold;">Autor</span></div>
          </div>
          <div style="text-align: right;">
            <div
              style="font-weight: bold; background: var(--surface-border); padding: 0.5rem 1rem; border-radius: 20px; display: inline-block;">
              ‚è± <span id="viewTime">0</span> Min
            </div>
            <div style="margin-top: 0.5rem; color: var(--text-muted); font-size: 0.9rem;">
              Schwierigkeit: <span id="viewDiff">Leicht</span>
            </div>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem; margin-top: 2rem;">
          <div style="background: var(--surface-border); padding: 1.5rem; border-radius: 12px;">
            <h3>Zutaten</h3>
            <div id="viewIng" class="markdown-body" style="margin-top: 1rem;"></div>
          </div>
          <div>
            <h3>Zubereitung</h3>
            <div id="viewSteps" class="markdown-body" style="margin-top: 1rem;"></div>
          </div>
        </div>

        <!-- Comments Section -->
        <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--surface-border);">
          <h3>Kommentare</h3>
          <div id="commentsList" style="margin-top: 1rem; display: flex; flex-direction: column; gap: 1rem;">
            <!-- Injected by JS -->
          </div>
          <form id="commentForm" onsubmit="app.submitComment(event)" style="margin-top: 2rem; display: none;">
            <div style="display: flex; gap: 1rem;">
              <input type="text" id="commentText" class="form-control" placeholder="Schreibe einen Kommentar..."
                required>
              <button type="submit" class="btn-primary">Posten</button>
            </div>
          </form>
          <div id="commentLoginPrompt" style="margin-top: 1rem; color: var(--text-muted); font-style: italic;">Bitte
            logge dich ein, um zu kommentieren.</div>
        </div>
      </div>
      <button class="modal-close-bottom" type="button" onclick="closeModal('viewRecipeModal')"
        style="transform: translateY(-1rem) translateX(-1rem);">Schlie√üen</button>
    </div>
  </div>

  <!-- EDIT PROFILE MODAL -->
  <div class="modal-overlay" id="editProfileModal" onclick="if(event.target === this) closeModal('editProfileModal')">
    <div class="modal">
      <h2 style="margin-bottom: 2rem;">Profil <span class="text-gradient">bearbeiten</span></h2>
      <form id="editProfileForm" onsubmit="app.submitProfileEdit(event)">
        <div class="form-group" style="text-align: center; margin-bottom: 2rem;">
          <div
            style="width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 1rem auto; overflow:hidden; background: var(--surface-border); border: 3px solid var(--primary); display: flex; justify-content: center; align-items:center;">
            <img id="editProfilePreviewImg" src="" style="width:100%; height:100%; object-fit:cover; display:none;">
            <span id="editProfileInitials" style="font-weight:bold; font-size:2rem; color:var(--text-muted);">?</span>
          </div>
          <input type="file" id="editProfileUpload" accept="image/*" style="display:none;"
            onchange="app.previewProfileImage(event)">
          <button type="button" class="btn-glass" onclick="document.getElementById('editProfileUpload').click()">Bild
            √§ndern</button>
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="editProfileEmail" class="form-control" required>
        </div>
        <div class="form-group">
          <label>Neues Passwort (optional)</label>
          <input type="password" id="editProfilePassword" class="form-control"
            placeholder="Leer lassen, um aktuelles zu behalten">
        </div>
        <div class="form-group">
          <label>Geburtsdatum</label>
          <input type="date" id="editProfileDob" class="form-control">
        </div>
        <div class="form-group">
          <label>√úber mich (Bio)</label>
          <textarea id="editProfileBio" class="form-control" rows="3"></textarea>
        </div>
        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
          <button type="button" class="btn-glass"
            style="flex: 1; color: var(--primary-hover); border-color: var(--primary-hover);"
            onclick="app.deleteProfile()">Profil l√∂schen</button>
          <button type="submit" class="btn-primary" style="flex: 2; justify-content: center;">Speichern</button>
        </div>
      </form>
      <button class="modal-close-bottom" type="button" onclick="closeModal('editProfileModal')">Schlie√üen</button>
    </div>
  </div>

  <!-- EDIT RECIPE MODAL -->
  <div class="modal-overlay" id="editRecipeModal" onclick="if(event.target === this) closeModal('editRecipeModal')">
    <div class="modal" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h2>Rezept <span class="text-gradient">bearbeiten</span></h2>
        <button class="btn-glass" style="color: var(--primary-hover); border-color: var(--primary-hover);"
          id="deleteRecipeBtn">L√∂schen</button>
      </div>
      <form id="editRecipeForm" onsubmit="app.submitEditRecipe(event)">
        <input type="hidden" id="editRezeptId">
        <input type="hidden" id="editRecipeRemoveImage" name="remove_image" value="false">
        <!-- Image Upload Area -->
        <div style="position: relative; width: 100%; height: 200px; margin-bottom: 1.5rem;">
          <div class="form-group"
            style="position:relative; width:100%; height:100%; margin-bottom: 0; border:2px dashed var(--primary); border-radius: 12px; display:flex; justify-content:center; align-items:center; overflow:hidden; cursor:pointer;"
            onclick="document.getElementById('editRecipeImageInput').click()" id="editImageDropZone">
            <span
              style="color:var(--text-muted); pointer-events:none; z-index:2; padding:1rem; text-align:center; background:var(--surface); border-radius:12px; backdrop-filter:var(--glass-fx);">Neues
              Bild hochladen (optional)<br><small>(Klick oder Drag&Drop)</small></span>
            <img id="editImagePreview"
              style="position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:1;">
          </div>
          <button type="button" id="editRecipeRemoveBtn" class="btn-primary"
            style="display: none; position: absolute; top: 10px; right: 10px; z-index: 10; padding: 0.2rem 0.6rem; font-size: 0.8rem; border-radius: 8px; background: rgba(220, 38, 38, 0.8);"
            onclick="event.stopPropagation(); app.removeEditImage()">Entfernen</button>
        </div>
        <input type="file" id="editRecipeImageInput" accept="image/*" style="display:none;"
          onchange="app.previewEditImage(event)">

        <div class="form-group"><label>Titel</label><input type="text" id="eTitle" class="form-control" required></div>
        <div style="display: flex; gap: 1rem;">
          <div class="form-group" style="flex:1"><label>Zubereitungszeit (Min)</label><input type="number" id="ePrep"
              class="form-control" required></div>
          <div class="form-group" style="flex:1"><label>Kochzeit (Min)</label><input type="number" id="eCook"
              class="form-control" required></div>
        </div>
        <div class="form-group">
          <label>Schwierigkeit</label>
          <select id="eDiff" class="form-control">
            <option value="leicht">Leicht</option>
            <option value="mittel">Mittel</option>
            <option value="schwer">Schwer</option>
          </select>
        </div>
        <div class="form-group">
          <label>Kategorie</label>
          <select id="eCat" class="form-control">
            <option value="Fr√ºhst√ºck">Fr√ºhst√ºck</option>
            <option value="Hauptgericht">Hauptgericht</option>
            <option value="Dessert">Dessert</option>
            <option value="Vegetarisch">Vegetarisch</option>
            <option value="Sonstiges">Sonstiges</option>
          </select>
        </div>
        <div class="form-group">
          <label>Tags (Optional)</label>
          <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; flex-wrap: wrap;" id="eTagsContainer"></div>
          <div style="display: flex; gap: 0.5rem;">
            <input type="text" id="eTagInput" class="form-control"
              placeholder="Tag eingeben (z.B. low-carb) und Enter dr√ºcken"
              onkeypress="if(event.key === 'Enter') { event.preventDefault(); app.addTag('eTagInput', 'eTagsContainer', 'eTagsArray'); }">
            <button type="button" class="btn-glass"
              onclick="app.addTag('eTagInput', 'eTagsContainer', 'eTagsArray')">Hinzuf√ºgen</button>
          </div>
          <input type="hidden" id="eTagsArray" name="tags" value="">
        </div>
        <div class="form-group markdown-editor-group">
          <label style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 0.5rem;">
            <span>Zutaten</span>
            <span style="font-size: 0.8rem; color: var(--text-muted);">Editor | Live Preview</span>
          </label>
          <div style="display: flex; gap: 1rem; height: 150px;">
            <textarea id="eIng" class="form-control"
              style="flex: 1; resize: none; overflow-y: auto; font-family: monospace;"
              oninput="app.updateLivePreview('eIng', 'eIngPreview')" required></textarea>
            <div id="eIngPreview" class="markdown-body form-control"
              style="flex: 1; background: var(--surface); overflow-y: auto;">*Live Preview...*</div>
          </div>
        </div>
        <div class="form-group markdown-editor-group">
          <label style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 0.5rem;">
            <span>Zubereitungsschritte</span>
            <span style="font-size: 0.8rem; color: var(--text-muted);">Editor | Live Preview</span>
          </label>
          <div style="display: flex; gap: 1rem; height: 250px;">
            <textarea id="eSteps" class="form-control"
              style="flex: 1; resize: none; overflow-y: auto; font-family: monospace;"
              oninput="app.updateLivePreview('eSteps', 'eStepsPreview')" required></textarea>
            <div id="eStepsPreview" class="markdown-body form-control"
              style="flex: 1; background: var(--surface); overflow-y: auto;">*Live Preview...*</div>
          </div>
        </div>

        <button type="submit" class="btn-primary" style="width: 100%; justify-content: center;">√Ñnderungen
          speichern</button>
      </form>
      <button class="modal-close-bottom" type="button" onclick="closeModal('editRecipeModal')">Schlie√üen</button>
    </div>
  </div>

  <!-- PUBLIC PROFILE MODAL -->
  <div class="modal-overlay" id="publicProfileModal"
    onclick="if(event.target === this) closeModal('publicProfileModal')">
    <div class="modal" style="max-width: 600px; text-align: center;">
      <div style="margin-top: 2rem; position: relative; display: inline-block;">
        <img id="pubProfileImg" src=""
          style="width: 120px; height: 120px; border-radius: 50%; border: 4px solid var(--primary); object-fit: cover;">
        <div id="pubLevelBadge"
          style="position: absolute; bottom: -10px; right: -10px; background: var(--secondary); color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; font-weight: bold; border: 3px solid var(--surface-border); box-shadow: 0 4px 10px rgba(0,0,0,0.5);">
          1</div>
      </div>

      <h2 style="margin-top: 1rem; margin-bottom: 0.5rem;" id="pubUsername">@Username</h2>
      <div id="pubSpecialTitle"
        style="color: #fbbf24; font-weight: bold; font-size: 0.9rem; margin-bottom: 1rem; display: none;">‚ú® Meisterkoch
        ‚ú®</div>

      <p id="pubBio" style="color: var(--text-muted); margin-bottom: 2rem; max-width: 80%; margin-inline: auto;">Keine
        Bio vorhanden.</p>

      <div style="background: var(--surface-border); padding: 1rem; border-radius: 12px; display: inline-block;
      margin-bottom: 2rem;">
        <div style="font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px;">
          Erfahrungspunkte (XP)</div>
        <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);" id="pubXp">0</div>
      </div>

      <div style="margin-bottom: 1.5rem;">
        <button id="pubViewRecipesBtn" class="btn-primary" style="margin: 0 auto; justify-content: center;">
          Rezepte von diesem Nutzer ansehen
        </button>
      </div>

      <button class="modal-close-bottom" type="button" onclick="closeModal('publicProfileModal')">Schlie√üen</button>
    </div>
  </div>

  <!-- FLOATING BUTTONS -->
  <button class="btn-primary" id="floatingAddBtn" onclick="openModal('recipeModal')" title="Neues Rezept erstellen"
    style="display: none; position: fixed; bottom: 2rem; left: 2rem; z-index: 1000; border-radius: 50%; width: 60px; height: 60px; padding: 0; box-shadow: 0 10px 25px rgba(251, 113, 133, 0.5); font-size: 2rem; justify-content: center; align-items: center;">
    +
  </button>

  <button class="btn-glass" id="scrollToTopBtn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
    title="Nach oben"
    style="opacity: 0; pointer-events: none; position: fixed; bottom: 2rem; right: 2rem; z-index: 1000; border-radius: 50%; width: 50px; height: 50px; padding: 0; display: flex; justify-content: center; align-items: center; transition: opacity 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.3);">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="18 15 12 9 6 15" />
    </svg>
  </button>

  <script src="js/app.js?v=2"></script>
</body>

</html>